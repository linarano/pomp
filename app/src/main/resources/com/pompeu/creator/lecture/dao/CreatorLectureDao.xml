<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.pompeu.creator.lecture.dao.CreatorLectureDao">

<!--
  <resultMap id="lectureListMap" type="lectureList">
   
    <id column="lecture_no" property="lectureNo"/>
    <result column="creatorNo" property="creatorNo"/>
    <result column="classTitle" property="classTitle"/>
    <result column="startDate" property="startDate"/>
    <result column="endDate" property="endDate"/>
    <result column="status" property="status"/>
    <result column="register_date" property="status"/>
        
    <association property="writer" javaType="creator">
      <id column="no" property="no"/>
      <result column="name" property="name"/>
    </association>
        
    <collection property="times" ofType="lectureTime">
     <id column="no" property="no"/>
     <result column="lecture_no" property="lectureNo"/>
     <result column="startTime" property="startTime"/>
     <result column="endTime" property="endTime"/>
      <result column="maxMember" property="maxMember"/>
      <result column="membercount" property="noMember"/>
    </collection>  
    
        le.creator_no creatorNo,
        le.lecture_no  lectureNo,
        le.name        classTitle,
        le.start_date  startDate,
        le.end_date    endDate,
        le.status,
        le.register_date,
        img.upload_img,
        t.times_check
    
    
  
    <collection property="img" ofType="lectureImage">
     <id column="no" property="no"/>
     <result column="lecture_no" property="lectureNo"/>
     <result column="startTime" property="startTime"/>
     <result column="endTime" property="endTime"/>
      <result column="maxMember" property="maxMember"/>
      <result column="membercount" property="noMember"/>
    </collection> 
    
  

  </resultMap>
 
    <resultMap type="insertImages" id="insertImagesMap">
    <id column="lecture_no" property="no"/>
    <result column="contact_no" property="contactNo"/>
    <result column="tt_no" property="telTypeNo"/>
    <result column="tel" property="tel"/>
  </resultMap>
  
 -->

  <select id="findAllMyclass" resultType="lectureList" parameterType="int">
    select
	    le.creator_no creatorWriter,
	    le.lecture_no  lectureNo,
	    le.name        classTitle,
	    le.start_date  startDate,
	    le.end_date    endDate,
	    le.status,
	    le.register_date registerDate,
	    img.upload_img uploadImg,
	    t.times_check timesCheck
	from lecture le
        left outer join (select
                            img.lecture_no lecture_no, 
                            count(*) as upload_img
                        from lecture_image img 
                        group by img.lecture_no) as img on img.lecture_no =le.lecture_no
        left outer join (select 
                            t.lecture_no, count(*) as times_check
        from lecture_time t group by t.lecture_no) as t on t.lecture_no=le.lecture_no
       where 
       le.creator_no =#{no}
       order by register_date desc
      
  </select>
  
    <!-- 자동 증가된 PK 값을 받고 싶을 때! -->
  <insert id="insert" parameterType="lecture" keyProperty="no" keyColumn="lecture_no" useGeneratedKeys="true">
    insert into lecture(location_no,creator_no, ex_no, name, start_date, end_date,lecture_price,lecture_info, register_date,status,in_out_ex, address) 
    values(#{locationNo},#{creatorNo}, #{exNo}, #{name}, #{startDate}, #{endDate},#{lecturePrice},#{lectureInfo}, #{registerDate},#{status},#{inOutEx}, #{address})
  </insert>
  
    <insert id="insertImages">
    insert into lecture_image(lecture_no,lecture_image_no, image)
    values
    <foreach collection="images" item="lectureImage" separator=",">
      (#{lectureNo}, #{lectureImage.lectureImageNo}, #{lectureImage.images}) 
    </foreach>
  </insert>
  
    <insert id="insertTimes">
    insert into lecture_times(lecture_no, lecture_time_no, image)
    values
    <foreach collection="times" item="lectureTime" separator=",">
      (#{lectureNo}, #{lectureTime.lectureNo}, #{lectureTime.times}) 
    </foreach>
  </insert>

</mapper>
