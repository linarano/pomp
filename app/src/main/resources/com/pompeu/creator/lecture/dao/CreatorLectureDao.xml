<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.pompeu.creator.lecture.dao.CreatorLectureDao">

<!--
  <resultMap id="lectureListMap" type="lectureList">
   
    <id column="lecture_no" property="lectureNo"/>
    <result column="creatorNo" property="creatorNo"/>
    <result column="classTitle" property="classTitle"/>
    <result column="startDate" property="startDate"/>
    <result column="endDate" property="endDate"/>
    <result column="status" property="status"/>
    <result column="register_date" property="status"/>
        
    <association property="writer" javaType="creator">
      <id column="no" property="no"/>
      <result column="name" property="name"/>
    </association>
        
    <collection property="times" ofType="lectureTime">
     <id column="no" property="no"/>
     <result column="lecture_no" property="lectureNo"/>
     <result column="startTime" property="startTime"/>
     <result column="endTime" property="endTime"/>
      <result column="maxMember" property="maxMember"/>
      <result column="membercount" property="noMember"/>
    </collection>  
    
        le.creator_no creatorNo,
        le.lecture_no  lectureNo,
        le.name        classTitle,
        le.start_date  startDate,
        le.end_date    endDate,
        le.status,
        le.register_date,
        img.upload_img,
        t.times_check
    
    
  
    <collection property="img" ofType="lectureImage">
     <id column="no" property="no"/>
     <result column="lecture_no" property="lectureNo"/>
     <result column="startTime" property="startTime"/>
     <result column="endTime" property="endTime"/>
      <result column="maxMember" property="maxMember"/>
      <result column="membercount" property="noMember"/>
    </collection> 
    
  

  </resultMap>
  -->

  <select id="findAllMyclass" resultType="lectureList" parameterType="int">
    select
	    le.creator_no creatorWriter,
	    le.lecture_no  lectureNo,
	    le.name        classTitle,
	    le.start_date  startDate,
	    le.end_date    endDate,
	    le.status,
	    le.register_date registerDate,
	    img.upload_img uploadImg,
	    t.times_check timesCheck
	from lecture le
        left outer join (select
                            img.lecture_no lecture_no, 
                            count(*) as upload_img
                        from lecture_image img 
                        group by img.lecture_no) as img on img.lecture_no =le.lecture_no
        left outer join (select 
                            t.lecture_no, count(*) as times_check
        from lecture_time t group by t.lecture_no) as t on t.lecture_no=le.lecture_no
       where 
       le.creator_no =#{no}
       order by register_date desc
      
  </select>

</mapper>
