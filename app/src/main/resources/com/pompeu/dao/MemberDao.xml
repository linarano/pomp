<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.pompeu.dao.MemberDao">

  <resultMap type="member" id="memberMap">
    <id column="member_no" property="no"/>
    <result column="name" property="name"/>
    <result column="email" property="email"/>
    <result column="phone" property="phone"/>
    <result column="nickname" property="nickName"/>
    <result column="use_check;" property="useCheck"/>    
    <result column="login_date" property="loginDate"/>
    <result column="join_date" property="joinDate"/>
    <result column="modify_date" property="modifyDate"/>
    <result column="admin_check" property="adminCheck"/>
    <result column="password" property="password"/>
    <result column="birth" property="birth"/>
    <result column="gender" property="gender"/>
    <result column="sns_no" property="snsNo"/>
    <result column="member_type_no" property="memberTypeNo"/>
    <result column="member_type_no_name" property="memberTypeNoName"/>
  </resultMap>

  <select id="countAll" resultType="int">
    select count(*) from member
  </select>
  
  <select id="findAll" resultMap="memberMap">
    select 
      member_no,
      name,
      email,
      phone,
      nickname,
      login_date,
      join_date
    from 
      member 
    order by 
      member_no asc
  </select>
  
  <insert id="insert" parameterType="member">
    insert into member(name,email,phone,nickname,use_check,join_date,modify_date,admin_check,password,birth,gender,sns_no) 
    values(#{name},#{email},#{phone},#{nickName},#{useCheck},#{joinDate},#{modifyDate},#{adminCheck},#{password},#{birth},#{gender},#{snsNo})
  </insert>
  
  <select id="findByNo" resultMap="memberMap" parameterType="int">
    select 
      member_no,
      name,
      email,
      phone,
      nickname,
      use_check,
      login_date,
      join_date,
      modify_date,
      admin_check,
      password,
      birth,
      gender,
      sns_no
    from 
      member 
    where 
      member_no=#{no}
  </select>

  <update id="update" parameterType="member">
    update member set 
	    name=#{name},
	    email=#{email},
	    phone=#{phone},
	    nickname=#{nickName},
	    use_check=#{useCheck},
	    join_date=#{joinDate},
	    modify_date=#{modifyDate},
	    admin_check=#{adminCheck},
	    password=#{password},
	    birth=#{birth},
	    gender=#{gender},
	    sns_no=#{snsNo}
    where 
      member_no=#{no}
  </update>

  <delete id="delete" parameterType="int">
    delete from member 
    where member_no=#{no}
  </delete>
  
  <select id="findCount" resultType="hashmap">
    select count(*)                                                    as total
		    ,  count(case when use_check = 0 then 1 else null end )        as creator
		    ,  count(case when use_check = 1 then 1 else null end )        as user
		  from member
		 where use_check in (0, 1)
  </select>
  
  <select id="srchMember" parameterType="member" resultType="hashmap">
    select 
      member_no                                           as member,  
      memeber_type_no                                     as member_type_no,
      case when memeber_type_no = 1 then '이용자' 
           when memeber_type_no = 2 then '크리에이터'
       end                                                as member_type_no_name,
      nickname                                            as nickname,
      name                                                as name,
      email                                               as email,
      phone                                               as phone
    from 
      member 
    where 1=1      
    <if test="memberTypeNo != null and memberTypeNo != 0">
      and memeber_type_no = #{memberTypeNo}
    </if>
    <if test="nickName != null">
      and nickname = #{nickName}
    </if>
    <if test="phone != null">
      and phone = #{phone}
    </if>
    <if test="email != null">
      and email = #{email}
    </if>
    order by 
      member_no asc
  </select>

</mapper>








